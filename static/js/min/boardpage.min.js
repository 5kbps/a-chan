"use strict";function byID(a){return document.getElementById(a)}function byClass(a){return document.getElementsByClassName(a)}function byTag(a){return document.getElementsByTagName(a)}function byName(a){return document.getElementsByName(a)}function Cycle(a,b){for(var c=0;a>c;c++)b(c)}function CycleThrough(a,b){for(var c in a)a.hasOwnProperty(c)&&"length"!=c&&b(c)}function pushStyle(a){var b=newElement("style");return b.innerHTML=a,document.head.appendChild(b),b}function collect(){for(var a={},b=arguments.length,c=0;b>c;c++)for(var d in arguments[c])arguments[c].hasOwnProperty(d)&&(a[d]=arguments[c][d]);return a}function newElement(a){return document.createElement(a)}function newTextNode(a){return document.createTextNode(a)}function insertAfter(a,b){var c=b.parentNode,d=b.nextSibling;return d?c.insertBefore(a,d):c.appendChild(a)}function stopPropagation(a){"function"==typeof a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function getOffset(a){var b=a.getBoundingClientRect();return{x:b.left,y:b.top,right:b.right,bottom:b.bottom,h:b.height,w:b.width}}function normalizeIntLength(a,b,c){if(c=c?c:"0",a+="",a.length<b)for(var d=0;d<b-a.length;d++)a=c+a;return a}function getInt(a){for(var b=[],c=0;c<a.length;c++)-1!="1234567890".indexOf(a[c])?b.push(a[c]):0;return 1*b.join([])}function genPassword(){for(var a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b="",c=0;10>c;c++){var d=Math.floor(Math.random()*a.length);b+=a.substring(d,d+1)}return b}function ellipsis(a,b){var c="...";return a.length>b-c.length?a.substr(0,b)+c:a}function getWindowSize(){var a=window,b=document,c=b.documentElement,d=b.getElementsByTagName("body")[0],e=a.innerWidth||c.clientWidth||d.clientWidth,f=a.innerHeight||c.clientHeight||d.clientHeight;return{x:e,y:f}}function loadSettings(){"undefined"==typeof localStorage.settings&&applyDefaultSettings(),Settings=JSON.parse(localStorage.settings),Settings||(Settings=[])}function getSetting(a){return Settings||loadSettings(),"time_format"==a&&1*getSetting("time_format_i")<2&&(Settings[a]=DefaultSettings[a],Settings.time_format_i=2,saveSettings()),"undefined"==typeof Settings[a]?"undefined"==typeof DefaultSettings[a]?!1:(Settings[a]=DefaultSettings[a],saveSettings(),DefaultSettings[a]):Settings[a]}function getPostNumByElem(a){for(;a.parentNode;){if("reply"==a.className||"thread"==a.className)return getInt(a.id);a=a.parentNode}return null}function applyDefaultSettings(){Settings=DefaultSettings,saveSettings()}function saveSettings(){localStorage.settings=JSON.stringify(Settings)}function setCookie(a,b,c){c=c||{};var d=c.expires;if("number"==typeof d&&d){var e=new Date;e.setTime(e.getTime()+1e3*d),d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString()),b=encodeURIComponent(b);var f=a+"="+b;for(var g in c){f+="; "+g;var h=c[g];h!==!0&&(f+="="+h)}document.cookie=f}function getCookie(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):""}function isMobile(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}function constructElementTree(a){var b,c,d=[];a=a.map(newElement),b=a[0],c=b,d.push(b);for(var e=1;e<a.length;e++)b.appendChild(a[e]),d.push(a[e]),console.log(a[e]),console.log(d),b=a[e];return{list:d,last:b,first:c}}function constructElementList(a){return a.map(newElement)}function decodeHTML(a){var b=newElement("span");return b.innerHTML=a,b.textContent}function isPostOnScreen(a){var b=byID("reply"+a);if(b){var c=getOffset(b),d=getWindowSize();return c.y>0&&c.y+c.h<d.y}return!1}function addShowPostEvents(a){if(!a){updateRefMap();var a=[];CycleThrough(Ref.map,function(b){var c=Ref.map[b];CycleThrough(c,function(b){a.push(c[b].link)})})}for(var b=0;b<a.length;b++){var c=a[b];if(c.className.indexOf("ref")+1&&!c.byClass("selfindicator").length){var d=config.is_mobile?"onclick":"onmouseenter";c[d]=function(){showPost(this)}}}}function addReflist(a,b,c){var d=newElement("span");return d.className="reflist",d.id="reflist"+b,c?a.appendChild(d):a.byClass("opreflist").appendChild(d),d}function postElementByNum(a){return byID("reply"+a)?byID("reply"+a):byID("thread"+a+config.board)?byID("thread"+a+config.board):!1}function isLinkInLoadedPost(a){for(;a.parentNode;){if(a.className==config.loaded_post_class)return!0;a=a.parentNode}return!1}function getOtherPosts(a){for(var b=[],c=a.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++)b.push(c[d].className.split("|")[3]);return b}function removeOtherPosts(a){for(var b=getOtherPosts(a),c=0;c<b.length;c++)byID(config.loaded_post_class+"-"+b[c])&&byID(config.loaded_post_class+"-"+b[c]).remove()}function highlightPost(a){var b=postElementByNum(a);b.addClass(config.highlighted_post_class)}function showPost(a){var b=a.className.split("|")[1],c=1*a.className.split("|")[3],d=1*a.className.split("|")[2],e=a.parentNode.parentNode;if(isPostOnScreen(c)&&!isLinkInLoadedPost(a))return highlightPost(c),removeOtherPosts(a),void(a.onmouseleave=function(){setTimeout(function(){byClass(config.highlighted_post_class).length&&byClass(config.highlighted_post_class)[0].removeClass(config.highlighted_post_class)},config.highlighted_post_delay)});if(cache.posts[b+"/"+c])return void addPost(a,cache.posts[b+"/"+c],c,d,e,b);if(byID("reply"+c))return void addPost(a,byID("reply"+c).parentNode.outerHTML,c,d,e,b);if(c&&"number"==typeof c){var f=document.location.protocol+"//"+document.location.host+"/read.php?b="+b+"&t="+d+"&p="+c+"&single";if(cache.requests[d+" "+c+" "+b])var g=cache.requests[d+" "+c+" "+b];else{var g=new XMLHttpRequest;g.open("GET",f,!0),g.send(null),cache.requests[d+" "+c+" "+b]=g}g.onreadystatechange=function(){var f;4==this.readyState&&(200==this.status?(f=this.responseText,f.trim()?cache.posts[b+"/"+c]=f:f=replyLike(_("Post not found!"))):f=replyLike(_("Error: no internet connection.")),addPost(a,f,c,d,e,b),delete cache.requests[d+" "+c+" "+b])}}}function replyLike(a){return'<span class="'+config.reply_like_class+'">'+a+"</span>"}function highlightLinkByPostNum(a,b){CycleThrough(b,function(c){var d=b[c];if(d.className&&4==d.className.split("|").length){var e=d.className.split("|")[3];e==a?d.id=config.underlined_link_id:d.id=d.id.replaceAll(config.underlined_link_id,"")}})}function addPost(a,b,c,d,e,f){if(!f)var f=config.board;removeOtherPosts(a);var g=newElement("div");g.className=config.loaded_post_class,g.id=config.loaded_post_class+"-"+c,g.innerHTML=b,byID("posts-container").appendChild(g),g.pushStyleArray({position:"absolute","z-index":"20"}),g.byClass("thread")[0]&&(g.byClass("thread")[0].className="reply");var h=byID("refcontainer-"+(getSetting("reflist_on_top")?"top":"bottom")+"-"+c);if(h){var i=h.cloneNode(1);byID("refcontainer-"+(getSetting("reflist_on_top")?"top":"bottom")+"-"+c);var j=g.byClass("refcontainer-"+(getSetting("reflist_on_top")?"top":"bottom"))[0];j&&j.parentNode.replaceChild(i,j)}addShowPostEvents(g.byTag("a")),translateUI(),addRefs(),highlightLinkByPostNum(getPostNum(a),g.byTag("a")),formatTime(),YouTube.init();var k=getWindowSize(),l=getOffset(a),m=getOffset(g),n={x:0,y:0,w:0,h:0};m.w>k.x&&(n.w=k.w),m.h>k.h&&(n.h=k.h),l.x>k.x/2?n.x=l.x+l.w/2-m.w:n.x=l.x+l.w/2;var o=0;if(l.y>k.y/2){n.y=l.y-m.h;var o=1}else n.y=l.y+l.h;if(n.x<0?n.x=0:"",n.x+m.w>k.x?n.x=k.x-m.w:"",o){g.style.left=n.x+scrollX+"px";var p=getOffset(document.body).h-scrollY-l.bottom+l.h;g.style.bottom=p+"px"}else g.style.left=n.x+scrollX+"px",g.style.top=n.y+scrollY+"px";n.x+m.w>k.y&&(g.style.right="0")}function hidePosts(){byID("posts-container").innerHTML=""}function getPostNum(a){for(;;){if(null==a)return 0;if(("post-text"==a.className||!a.parentNode)&&a.id)return a.id.split("-")[2];if("refcontainer-bottom"==a.className||"refcontainer-top"==a.className)return a.id.split("-")[2];a=a.parentNode}}function isInReflist(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(d.className&&d.className.split("|")[3]==b+"")return!0}return!1}function updateRefMap(){Ref={map:{},list:[]};for(var a=document.links,b=0;b<a.length;b++){var c=a[b];if(c.className.indexOf("ref")+1&&4==c.className.split("|").length&&-1==c.parentNode.className.indexOf("refcontainer")){var d=c.className.split("|")[3],e=c.className.split("|")[1],f=getPostNum(c),g=c.className.split("|")[2];if(f)if(d!=f)"undefined"==typeof Ref.map[f]&&(Ref.map[f]=[]),Ref.map[f].push({refNum:d,refBoard:e,threadNum:g,link:c});else if(!c.byClass("selfindicator").length){var h=newElement("span");h.className="selfindicator",h.innerHTML=config.reflink_self_postfix,c.appendChild(h)}}}}function addRefs(){var a=_("Replies:");if(getSetting("reflinks")){updateRefMap();for(var b=Ref.map.getKeys(),c=0;c<b.length;c++){var d=b[c];if(1*d)for(var e=Ref.map[d],f=0;f<e.length;f++){var g=e[f],h=g.refNum,i=g.refBoard;if(i==config.board){var j=g.threadNum,k=(g.link,getSetting("reflist_on_top")),l=byID("refcontainer-"+(k?"top":"bottom")+"-"+h);if(l&&!isInReflist(l,d)){if(!l.childNodes.length&&!k){var m=newElement("span");m.className="replies-str",m.textContent=a,l.appendChild(m)}var n=newElement("a"),o=config.reflink_prefix+d,p=newTextNode(o);n.appendChild(p),n.className="ref|"+i+"|"+j+"|"+d,n.href=document.location.protocol+"//"+document.location.host+"/"+i+"/res/"+j+".html#"+d,n.onmouseenter=function(){showPost(this)},l.appendChild(n)}}}}}}function updatePostCache(){}function addNavEvents(){document.body.addEventListener("click",function(){watchPosts(),updateTitle()}),window.addEventListener("focus",function(){checkForNewPosts(),getSetting("autoupdate")&&updateThread()}),document.body.addEventListener("mousemove",function(a){var b=flags.mouseposition.x,c=flags.mouseposition.y,d=a.clientX,e=a.clientY,f=Math.sqrt((b-d)*(b-d)+(c-e)*(c-e));flags.mouseposition.x=d,flags.mouseposition.y=e,f>config.hide_posts_mouse_move_delta&&(hidePosts(),watchPosts())}),byID(config.delform_id)&&byID(config.delform_id).addEventListener("click",function(){hidePosts()}),byID("postform")&&byID("postform").addEventListener("submit",function(a){submitAttempt(a)})}function expandthread(a,b){showMessage(_("Loading..."));var c=new XMLHttpRequest;return c.open("GET","/expand.php?board="+b+"&threadid="+a,!0),c.send(null),c.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){showMessage(_("Processing response..."));var b=new RegExp("reply-to-"+a),c=getInt(byName("postform")[0].parentNode.id);for(byID("postform").parentNode.parentNode.parentNode.className.match(b)&&(saveScrollPosition(),clearreplyto(),restoreScrollPosition());byClass("reply-to-"+a).length;)byClass("reply-to-"+a)[0].remove();var d=this.responseText||_("Something went wrong!"),e=document.createDocumentFragment(),f=newElement("div");for(f.innerHTML=d;f.firstChild;)e.appendChild(f.firstChild);byID("omitted-posts-"+a)&&byID("omitted-posts-"+a).remove(),insertAfter(e,byID("thread-wrapper-"+a)),translateUI(),loadSettings(),addRefs(),YouTube.init(),addShowPostEvents(document.links),formatTime(),doSpoilers(),hideHidden(),addShowPostEvents(),showMessage(_("Thread expanded"),2),c&&postReply(null,c,a,!0)}else showMessage(404==this.status?_("Error: thread not found (404)"):_("Something went wrong!"))},!1}function watchBoard(){loadSettings();var a=byClass("refcontainer-top"),b=1*getSetting("last_posts")[config.board],c=b;b=b?b:0;for(var d=0;d<a.length;d++){var e=1*a[d].id.split("-")[2];e>b&&(b=e)}b>c&&(Settings.last_posts[config.board]=b,saveSettings(),showMessage(_("New posts:")+" "+(1*b-1*c)))}function watchPosts(){for(;byClass(config.new_post_class).length;)byClass(config.new_post_class)[0].className=byClass(config.new_post_class)[0].className.replaceAll(config.new_post_class,"");updateTitle()}function purgeNewPostNotification(a){var b=a.id.split("-")[2],c=1*a.textContent.split("+")[1]+1*Settings.last_posts[b];Settings.last_posts[b]=1*c,saveSettings(),cache.new_posts[b]=0,byID("counter-top-"+b).remove(),byID("counter-bottom-"+b).remove(),faviconCounter(),updateTitle()}function purgeAllNewPostNotifications(){byClass("board-link-counter").map(purgeNewPostNotification)}function togglePostPreview(){var a=byID("message").value;if(""!=a){var b=byID("markup_wakabamark").checked?"&wakabamark=1":"",c=byID("markup_bbcode").checked?"&bbcode=1":"",d=byID("markup_other").checked?"&other=1":"",e=new XMLHttpRequest;e.open("POST",document.location.protocol+"//"+document.location.host+"/api.php",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded");var f="message="+encodeURIComponent(a)+b+c+d+"&board="+byName("board")[0].value+"&action=postpreview";e.send(f),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(null==byID("post-preview")){var a=document.createElement("div"),b=getOffset(byID("message")).h,c=this.responseText;a.innerHTML=c,a.className="post-preview",a.id="post-preview",a.style.height=b+"px",a.onclick=function(){this.remove(),byID("message").style.display="block",byID("message").focus()},byID("message").parentNode.appendChild(a),byID("message").style.display="none",addShowPostEvents()}else byID("post-preview").remove(),byID("message").style.display="block",byID("message").focus()}}else showMessage(_("Enter message first!"))}function saveScrollPosition(){for(var a=byClass("reply"),b=0;b<a.length;b++){var c=a[b],d=getOffset(c);if(d.y>0){cache.sse=c,cache.ssp=getOffset(c).y;break}}}function restoreScrollPosition(){cache.sse&&window.scrollBy(0,getOffset(cache.sse).y-cache.ssp)}function askForBugReport(a){console.log(JSON.stringify(a))}function startAutoUpdateTick(){config.thread?getSetting("autoupdate")&&(cache.updateInterval=setInterval(function(){updateThread()},1e3*getSetting("updateinterval"))):cache.updateInterval=setInterval(function(){checkForNewPosts()},1e3*getSetting("updateinterval"))}function getLastPostNumber(){for(var a=byClass("post-number"),b=0,c=0;c<a.length;c++){var d=getInt(a[c].id);d>b&&(b=d)}return b}function updateThread(){var a,b,c,d,e;if(config.thread){if(cache.updateThread)return;cache.updateThread=!0,setTimeout(function(){cache.updateThread=!1},config.min_update_interval),c=config.board,d=config.thread,b=getLastPostNumber(),e=document.location.protocol+"//"+document.location.host+"/"+config.api_path+"?action=readthread&board="+c+"&thread="+d+"&lastpost="+b;var a=null;a=new XMLHttpRequest,a.open("GET",e,!0),a.send(null),showMessage(_("Loading..."),0),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?processUpdateThreadResult(a.responseText):404==a.status?showMessage(_("Error: thread not found (404)"),0):202==a.status?showMessage(_("No new posts")):setTimeout(function(){showMessage(_("Error: server sent corrupted data."),0)},1e3))}}}function processUpdateThreadResult(a){var b=JSON.parse(a),c=b.count,d=b.html;return appendPostsToThread(d),c?(addNewPostIndicators(c),showMessage(_("New posts:")+" "+getNewPostCount()),loadSettings(),addRefs(),formatTime(),YouTube.init(),translateUI(),watchBoard(),addShowPostEvents(),checkForNewPosts(!0),void hideHidden()):void showMessage(_("No new posts"))}function addNewPostIndicators(a){for(var b=byClass("reply"),c=b.length-1;c>=b.length-a;){var d=b[c];d.className+=" "+config.new_post_class,c--}}function getNewPostCount(){return byClass(config.new_post_class).length}function appendPostsToThread(a){byID(config.delform_id).appendChild(create(a))}function create(a){var b=document.createDocumentFragment(),c=document.createElement("div");c.innerHTML=a;for(var d=[];c.firstChild;){var e=c.firstChild;if(e.tagName&&"div"==e.tagName.toLowerCase()){var f=getInt(e.getElementsByClassName("reply")[0].id);if(!(getLastPostNumber()<f))return b;b.appendChild(c.firstChild),d.push(f)}else c.firstChild.remove()}return b}function checkForNewPosts(a){function b(a,b){loadSettings();var c=JSON.parse(a);b&&(localStorage.last_check=Date.now(),localStorage.last_check_content=a);var d=getSetting("ignored_boards").split(",");for(var e in c)if(c.hasOwnProperty(e)&&!d.inArray(e)){var f=c[e],g=getSetting("last_posts");(!g[e]||g[e]>f)&&(g[e]=f,Settings.last_posts[e]=1*f);var h=1*Settings.last_posts[e],i=1*f,j=i-h;if(cache.new_posts[e]=j,j>0){var k=newElement("span");k.innerHTML="+"+(i-h),k.className="board-link-counter",k.id="counter-top-"+e,k.onclick=function(){purgeNewPostNotification(this)};var l=newElement("span");l.innerHTML="+"+(i-h),l.className="board-link-counter",l.id="counter-bottom-"+e,l.onclick=function(){purgeNewPostNotification(this)},null==byID(k.id)?(insertAfter(k,byClass("board-link-"+e)[0]),insertAfter(l,byClass("board-link-"+e)[1])):(byID("counter-top-"+e).innerHTML=k.innerHTML,byID("counter-bottom-"+e).innerHTML=l.innerHTML)}else byID("counter-top-"+e)&&byID("counter-top-"+e)&&(byID("counter-top-"+e).remove(),byID("counter-bottom-"+e).remove())}faviconCounter(),saveSettings(),updateTitle()}for(var c=0;4>c;c++)rollLogo();if(1*localStorage.last_check<Date.now()-config.min_update_interval&&!a&&cache.last_check<1*localStorage.last_check)return cache.last_check=localStorage.last_check,void b(localStorage.last_check_content);var d=new XMLHttpRequest;d.open("GET",document.location.protocol+"//"+document.location.host+"/api.php?action=lastpost&board=all&nocache="+Math.random(),!0),d.send(null),d.onreadystatechange=function(){4==this.readyState&&200==this.status&&b(this.responseText,!0)}}function isHidden(a){return!!byID("hs_"+a)}function addPostHideStyle(a){if(a&&!isHidden(a)){var b=newElement("style");b.id="hs_"+a;var c;c="#reply"+a+" > .post-text,",c+="#reply"+a+" > .nothumb,",c+="#reply"+a+" > .refcontainer-top,",c+="#reply"+a+" > .refcontainer-bottom,",c+="#reply"+a+" > br,",c+="#omitted-posts-"+a+",",c+="#threadexpand"+a+",",c+="#reply"+a+" > .filesize { display:none;}",c+="#reply"+a+" > br:last-of-type { display:block;}",c+="#refcontainer-bottom-"+a+" {display:none;}",c+="#refcontainer-top-"+a+" {display:none;}",c+="#reply"+a+" > br:last-of-type { display:block;}",c+="#reply"+a+"  { padding-bottom: 0;}",c+="#thread"+a+config.board+" > * {display: none;}",c+="#thread"+a+config.board+" > .postinfo, ",c+="#thread"+a+config.board+" > .postcontrols{display: inline;}",c+="#thumb"+a+"{display: none;}",c+=".post-hide-"+a+"{display:none;}",c+=".reply-to-"+a+"{display:none;}",c+=".post-reply-"+a+"{display:none;}",c+=".post-show-"+a+"{display:inline-block !important;}",c+="#loaded-post-"+a+" > * > .reply > .post-controls {display:inline-block !important;}",b.innerHTML=c,document.head.appendChild(b)}}function postHide(a,b){addPostHideStyle(b),getSetting("hidden")[config.board]||(Settings.hidden[config.board]="");for(var c=getSetting("hidden")[config.board].split(","),d=!1,e=0;e<c.length;e++)c[e]+""==b+""&&(d=!0);d?c:c.push(b),Settings.hidden[config.board]=c.join(","),saveSettings()}function postShow(a,b){removePostHideStyle(b),getSetting("hidden")[config.board]||(Settings.hidden[config.board]="");for(var c=getSetting("hidden")[config.board].split(","),d=[],e=0;e<c.length;e++)c[e]!=b+""?d.push(c[e]):0;Settings.hidden[config.board]=d.join(","),saveSettings()}function removePostHideStyle(a){byID("hs_"+a).remove()}function hideHidden(){if(getSetting("hidden")[config.board])for(var a=getSetting("hidden")[config.board].split(","),b=0;b<a.length;b++)addPostHideStyle(a[b])}function showMessage(a,b){var c;byID("message-div")?c=byID("message-div"):(c=newElement("div"),c.className="reply-like",c.id="message-div",c.onclick=function(){this.remove()}),document.body.appendChild(c),c.textContent=a,b&&setTimeout(function(){hideMessage()},1e3*b)}function getSelectionText(){var a="";return window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(a=document.selection.createRange().text),a}function rkmSave(a){}function insert(a){var b;b=""==getSelectionText()?"":"> ",document.getElementsByName("message")[0].value=document.getElementsByName("message")[0].value+a+b+getSelectionText()}function replaceSelectedText(a,b){var c=getInputSelection(a),d=a.value;a.value=d.slice(0,c.start)+b+d.slice(c.end)}function getInputSelection(a){var b,c,d,e,f,g=0,h=0;return"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd?(g=a.selectionStart,h=a.selectionEnd):(c=document.selection.createRange(),c&&c.parentElement()==a&&(e=a.value.length,b=a.value.replace(/\r\n/g,"\n"),d=a.createTextRange(),d.moveToBookmark(c.getBookmark()),f=a.createTextRange(),f.collapse(!1),d.compareEndPoints("StartToEnd",f)>-1?g=h=e:(g=-d.moveStart("character",-e),g+=b.slice(0,g).split("\n").length-1,d.compareEndPoints("EndToEnd",f)>-1?h=e:(h=-d.moveEnd("character",-e),h+=b.slice(0,h).split("\n").length-1)))),{start:g,end:h}}function postReply(a,b,c,d){if(!d){var e=byID("message");isHidden(b)&&postShow(0,b);var f=getSelection(),g=f.toString().trim(),h=addCitation(byID("message").value,g,b);if(e.value=h[0],"none"!=e.style.display){if(g)setSelectionRange(e,h[1],h[1]);else{var i=e.value.length;setSelectionRange(e,i,i)}setTimeout(function(){e.focus()},10)}}var j=byID("postform-container-"+b);j&&(j.appendChild(byID("postform")),byName("replythread")[0].value=c,byID("posttypeindicator").textContent=_("To thread")+" ",byID("formpostlink").href=document.location.protocol+"//"+document.location.host+"/"+config.board+"/res/"+c+".html#"+b,byID("formpostlink").textContent=c,config.thread||(byID("clearreplyto").style.display="inline-block",byID("formpostlink").style.display="inline-block",byID("clearreplyto").innerHTML=config.clearreplyto_text))}function addTagSel(a,b){var c=["[","]"],d=c[0]+a+c[1],e=c[0]+"/"+a+c[1],f=!1;if(f){var g=document.selection.createRange(),h=b.createTextRange(),i=h.duplicate();i.moveToBookmark(g.getBookmark()),h.setEndPoint("EndToStart",i);var j=d+g.text+e,k=b.value.replace(/[\r\n]/g,".").indexOf(g.text.replace(/[\r\n]/g,"."),h.text.length);b.value=b.value.substring(0,k)+j+b.value.substring(k+j.length,b.value.length);var l=b.value.length-e.length;h.collapse(!0),h.moveEnd("character",l),h.moveStart("character",l),h.select()}else if(b.selectionStart||"0"==b.selectionStart){var m=b.selectionStart,n=b.selectionEnd,j=d+b.value.substring(m,n)+e;b.value=b.value.substring(0,m)+j+b.value.substring(n,b.value.length),b.setSelectionRange(n+d.length,n+d.length),b.focus()}return j}function addTagToMsg(a){addTagSel(a,byID("message"))}function addCitation(a,b,c){var d,e=0;if(b&&(b="> "+b.trim().replaceAll("\n","\n> ").replaceAll("> \n","")),-1!=a.indexOf(">>"+c)){for(var f=a.split(/>>/),g=1;g<f.length;g++){var h=f[g];if(h){if(!h.indexOf(c)&&b){d=">>"+h.trim()+"\n"+b.trim()+"\n",b="",e+=d.length,f[g]=d;continue}d=">>"+h,b&&(e+=d.length),f[g]=d}else d=h,b&&(e+=d.length),f[g]=d}return[f.join(""),e]}a=a.trim(),a&&(a+="\n");var i=a+">>"+c+"\n"+b+(b?"\n":"");return[i,i.length]}function setSelectionRange(a,b,c){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,c);else if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d.select()}}function hideMessage(){byID("message-div")?byID("message-div").remove():""}function formatDate(a,b,c){function d(a,b){var c=a+"";for(b=b||2;c.length<b;)c="0"+c;return c}var e=TimeFormats.MMMM,f=TimeFormats.MMM,g=TimeFormats.dddd,h=TimeFormats.ddd,i=c?a.getUTCFullYear():a.getFullYear();b=b.replace(/(^|[^\\])yyyy+/g,"$1"+i),b=b.replace(/(^|[^\\])yy/g,"$1"+i.toString().substr(2,2)),b=b.replace(/(^|[^\\])y/g,"$1"+i);var j=(c?a.getUTCMonth():a.getMonth())+1;b=b.replace(/(^|[^\\])MMMM+/g,"$1"+e[0]),b=b.replace(/(^|[^\\])MMM/g,"$1"+f[0]),b=b.replace(/(^|[^\\])MM/g,"$1"+d(j)),b=b.replace(/(^|[^\\])M/g,"$1"+j);var k=c?a.getUTCDate():a.getDate();b=b.replace(/(^|[^\\])dddd+/g,"$1"+g[0]),b=b.replace(/(^|[^\\])ddd/g,"$1"+h[0]),b=b.replace(/(^|[^\\])dd/g,"$1"+d(k)),b=b.replace(/(^|[^\\])d/g,"$1"+k);var l=c?a.getUTCHours():a.getHours();b=b.replace(/(^|[^\\])HH+/g,"$1"+d(l)),b=b.replace(/(^|[^\\])H/g,"$1"+l);var m=l>12?l-12:0==l?12:l;b=b.replace(/(^|[^\\])hh+/g,"$1"+d(m)),b=b.replace(/(^|[^\\])h/g,"$1"+m);var n=c?a.getUTCMinutes():a.getMinutes();b=b.replace(/(^|[^\\])mm+/g,"$1"+d(n)),b=b.replace(/(^|[^\\])m/g,"$1"+n);var o=c?a.getUTCSeconds():a.getSeconds();b=b.replace(/(^|[^\\])ss+/g,"$1"+d(o)),b=b.replace(/(^|[^\\])s/g,"$1"+o);var p=c?a.getUTCMilliseconds():a.getMilliseconds();b=b.replace(/(^|[^\\])fff+/g,"$1"+d(p,3)),p=Math.round(p/10),b=b.replace(/(^|[^\\])ff/g,"$1"+d(p)),p=Math.round(p/10),b=b.replace(/(^|[^\\])f/g,"$1"+p);var q=12>l?"AM":"PM";b=b.replace(/(^|[^\\])TT+/g,"$1"+q),b=b.replace(/(^|[^\\])T/g,"$1"+q.charAt(0));var r=q.toLowerCase();b=b.replace(/(^|[^\\])tt+/g,"$1"+r),b=b.replace(/(^|[^\\])t/g,"$1"+r.charAt(0));var s=-a.getTimezoneOffset(),t=c||!s?"Z":s>0?"+":"-";if(!c){s=Math.abs(s);var u=Math.floor(s/60),v=s%60;t+=d(u)+":"+d(v)}b=b.replace(/(^|[^\\])K/g,"$1"+t);var w=(c?a.getUTCDay():a.getDay())+1;return b=b.replace(new RegExp(g[0],"g"),g[w]),b=b.replace(new RegExp(h[0],"g"),h[w]),b=b.replace(new RegExp(e[0],"g"),e[j]),b=b.replace(new RegExp(f[0],"g"),f[j]),b=b.replace(/\\(.)/g,"$1")}function formatTime(){if(getSetting("time_formatting")){for(var a=getSetting("time_format");byClass("raw-timestamp")[0];){var b=byClass("raw-timestamp")[0],c=1e3*b.value,d=new Date(c),e=formatDate(d,a),f=b.nextSibling;f.innerHTML=e,b.className="raw-timestamp-used"}hideFormattedTimestamp()}}function hideFormattedTimestamp(){if(!byID("formatted_timestamp_css")){var a=newElement("style");a.id="formatted_timestamp_css",a.innerHTML=".formatted_timestamp{display:none;}",document.head.appendChild(a)}}function doSpoilers(){getSetting("expandspoilers")||pushStyle(".fspoilertext{display:none;}")}function toggleSpoiler(a){var b=a.parentNode.byClass("fspoilertext")[0];-1==b.className.indexOf("fspoileropen")?b.className+=" fspoileropen ":b.className=b.className.replaceAll("fspoileropen","")}function insertPasswords(){byName("postpassword").length<2||(byName("postpassword")[0].value=getSetting("password"),byName("postpassword")[1].value=getSetting("password"))}function insertPreferences(){byName("preference")[0]&&(byName("preference")[0].value=getSetting("preference"))}function clearreplyto(){config.thread||(byID("clearreplyto").style.display="none",byID("clearreplyto").innerHTML="",byClass("postarea")[0].appendChild(byID("postform")),byID("posttypeindicator").textContent=_("New thread"),byID("formpostlink").href=document.location.protocol+"//"+document.location.host+"/"+config.board+"/",byID("formpostlink").textContent="",byID("formpostlink").style.display="none",byName("replythread")[0].value="0")}function getAllPostNumbers(){for(var a=[],b=byClass("post-number"),c=0;c<b.length;c++)a.push(getInt(b[c].id));return a}function clearFileSelect(){byID("fileupload-clear").style.display="none",byID("fileupload-list").innerHTML="",byID("fileupload").value=""}function handleFileSelect(a){byID("fileupload-list").innerHTML="",byID("fileupload-clear").style.display="inline";for(var b,c=a.target.files,d=0;b=c[d];d++)if(b.type.match("image.*")){var e=new FileReader;e.onload=function(a){return function(b){var c=newElement("span");c.innerHTML=['<img class="preloadthumb" title="'+_("Preview selected image")+'" src="',b.target.result,'" title="',escape(a.name),'"/>'].join(""),byID("fileupload-list").insertBefore(c,null)}}(b),e.readAsDataURL(b)}}function imgExpand(a,b,c,d){return a.hasClass("thumb-loading")?(a.src=c,a.className="thumb"):a.hasClass("thumb-expanded")?(a.className="thumb",a.src=c):(a.className="thumb thumb-loading",a.src=b,a.onload=function(){a.className="thumb thumb-expanded",a.onload=function(){}},a.onabort=function(){alert("cancel")}),d.preventDefault(),!1}function webmExpand(a){var b=a.parentNode.parentNode.href,c=newElement("span");c.className="webm-hide",c.textContent=_("Close"),c.onclick=function(a){webmClose(a)};var d=newElement("video");d.className="webm-video",d.autoplay=!0,d.controls=!0;var e=newElement("source");e.type="video/webm",e.src=b,d.appendChild(e),a.parentNode.parentNode.parentNode.insertAfter(c,a.parentNode.parentNode),a.parentNode.parentNode.parentNode.insertAfter(d,a.parentNode.parentNode),a.addClass("hidden-element")}function webmClose(a){var b=a.target;if(b.parentNode.byClass("webm-video")[0]&&b.parentNode.byClass("webm-video")[0].remove(),b.parentNode.byClass("webm-thumb")[0]&&b.parentNode.byClass("webm-thumb")[0].removeClass("hidden-element"),b.remove(),!a)var a=window.event;a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),a.preventDefault()}function rollLogo(){cache.rollLogo||(cache.rollLogo=0),cache.rollLogo++;var a=byID("logo-image-top"),b="rotate("+360*cache.rollLogo+"deg)";a.pushStyleArray({"-moz-transform":b,"-webkit-transform":b,"-ms-transform":b,"-o-transform":b,transform:b})}function scrollToEnd(){window.scroll(0,document.body.clientWidth)}function updateTitle(){if(!config.ispage){var a,b,c,d,e,f;if(c=getSetting("title_format"),d=byClass(config.new_post_class).length,d=d&&d>0?"("+d+") ":"",f=config.board,e=decodeHTML(config.boardNames[f]?" - "+config.boardNames[f]:""),config.thread)try{a=" - "+ellipsis(byClass("filetitle-thread")?byClass("filetitle-thread")[0].textContent.trim():"",30),b=" - "+ellipsis(byClass("posttext")?byClass("posttext")[0].textContent.trim():"",30)}catch(g){a="",b=" - "+_("Thread №")+config.thread}else a="",b="";c=d+"/"+f+"/ "+a+b+e,document.title=c}}function faviconCounter(){if(getSetting("tab_notification")){var a=byClass(config.board_link_counter_class).length;byID("favicon").href=a?"/favicon*.ico?":"/favicon.ico?"}}function highlightPostInURL(){for(var a=byClass(config.outlined_post_class),b=0;b<a.length;b++){var c=a[b];c.removeClass(config.outlined_post_class)}var d=1*document.location.href.split("#")[1];isNaN(d)||byID("reply"+d)&&byID("reply"+d).addClass(config.outlined_post_class)}function initConfig(){config.board=byName("board")[0].value}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _(a){return"undefined"!=typeof getText[getSetting("language")]&&"undefined"!=typeof getText[getSetting("language")][a]?getText[getSetting("language")][a]:a}function translateUI(){var a=byClass("gt");CycleThrough(a,function(b){
var c=a[b],d=c.tagName.toLowerCase();-1!=["input"].indexOf(d)?c.value=_(c.value):c.textContent=_(c.textContent)})}function checkPostingWithCallback(a){var b=byName("replythread")[0].value,c=new XMLHttpRequest;c.open("GET","/api.php?action=check_posting&board="+config.board+"&replythread="+b+"&nocache="+Math.random(),!0),c.send(null),c.onreadystatechange=function(){4==this.readyState&&200==this.status&&processPostingCheckResult(this.responseText,a)}}function checkPostingAndSend(){checkPostingWithCallback(sendForm)}function validatePostForm(){return!0}function onlyCheckPosting(){checkPostingWithCallback(function(){})}function processPostingCheckResult(a,b){console.log(a);var c=JSON.parse(a);config.captcha_min_length=c.captcha_min_length,0!=c.timeout&&startTimeout(c.timeout),""!=c.token?(addCaptcha(c.token),clearTimeout(cache.ttl_captcha_timer),cache.ttl_captcha_timer=setTimeout(captchaExpired,1e3*c.ttl)):isCaptchaAdded()||isPOWAdded()?(checkPassed(),showMessage(config.pow_allowed?_("Больше не нужно вводить капчу или вычислять POW."):_("Больше не нужно вводить капчу."))):b(),c.powvalue&&(byID("powrequired").value=c.powvalue,addPOW(c.powvalue))}function submitAttempt(a){return isCaptchaAdded()||isPOWAdded()||isCaptchaChecked()?isCaptchaEntered()||isCaptchaChecked()||isPOWCalculated()?void sendForm():(config.pow_allowed?alert(_("Пожалуйста, введите капчу или вычислите POW.")):alert(_("Пожалуйста, введите капчу.")),a.preventDefault(),!1):(checkPostingAndSend(),a.preventDefault(),!1)}function sendForm(){console.log("sendForm"),byID("postform").submit()}function startTimeout(a){alert(_("Необходимо подождать ")+a+_("с.")),cache.timeout_status=1,setTimeout(function(){cache.timeout_status=2},1e3*a)}function isCaptchaAdded(){return!!byID("captcha-image")}function isCaptchaEntered(){return isCaptchaAdded()&&byID("captcha-text").value.length>=config.captcha_min_length}function isCaptchaChecked(){return 5==cache.captcha_status}function checkCaptcha(){var a=byID("captcha-text").value,b=new XMLHttpRequest;b.open("GET","/captcha.php?action=check&token="+cache.captcha_token+"&code="+a,!0),b.send(null),cache.captcha_status=4,b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.log(this.responseText);var a=JSON.parse(this.responseText);"OK"==a.status?(showMessage(_("Капча введена верно.")),clearTimeout(cache.ttl_captcha_timer),cache.ttl_captcha_timer=setTimeout(captchaExpired,1e3*a.ttl),cache.captcha_status=5,checkPassed()):(showMessage(_("Капча не прошла проверку.")),onlyCheckPosting())}}}function addCaptcha(a){var b=newElement("img"),c=newElement("input"),d=newElement("span"),e="/captcha.php?action=get_image&token="+a;cache.captcha_token=a,cache.captcha_status=1,b.src=e,b.id="captcha-image",b.onclick=onlyCheckPosting,c.type="text",c.name="captcha",c.id="captcha-text",c.accessKey="c",c.onkeyup=function(){this.value.length>=cache.captcha_min_length?cache.captcha_status=3:cache.captcha_status=1},d.id="captcha-check",d.className="button-like",d.onclick=checkCaptcha,d.textContent=_("check"),byID("captcha-container").removeClass("hidden-element"),byID("captcha-image-container").innerHTML="",byID("captcha-input-container").innerHTML="",byID("captcha-check-container").innerHTML="",byID("pow-container").innerHTML="",byID("captcha-image-container").appendChild(b),byID("captcha-input-container").appendChild(c),byID("captcha-check-container").appendChild(d),c.focus()}function checkPassed(){byID("captchatoken").value=cache.captcha_token,byID("captcha-or-container").addClass("hidden-element"),byID("captcha-input-container").innerHTML="",byID("captcha-image-container").innerHTML=_("Проверка пройдена."),byID("captcha-check-container").innerHTML="",byID("pow-container").innerHTML=""}function captchaExpired(){isPOWCalculated()||(alert("Капча устарела!"),cache.captcha_status=2,onlyCheckPosting())}function removeCaptcha(){isCaptchaAdded()&&checkPassed()}function isPOWAdded(){return!!byID("powbutton")}function isPOWCalculated(){return!!byID("powvalue").value}function getPowSeconds(a){return Math.round(Math.pow(2,a)/1e3)}function addPOW(a){var b=newElement("input"),c=newElement("div");b.type="button",b.id="powbutton",b.value=_("Вычислить POW"),b.onclick=startPOWCalculation,c.innerHTML="(2<sup>"+(a+1)+"</sup> "+_("хешей")+" ≈ "+getPowSeconds(a)+" "+_("с.")+")",byID("pow-container").appendChild(b),byID("pow-container").appendChild(c),cache.pow_status=1}function removePOW(){}function confirmationTimer(){var a=byID("timeout"),b=getInt(a.textContent);if(1==b){var a=byID("timeout-item");a.textContent=_("You are now able to post."),clearInterval(cache.timeout)}else a.textContent=b-1}function startConfirmationTimer(){byID("timeout")&&(cache.timeout=setInterval(confirmationTimer,1e3))}function stringifyPost(a){if(!a)var a=byID("powtimestamp").value;return byID("message").value.replace(/\n/g,"\r\n")+a}function terminateWorkers(){for(var a in cache.powWorkers)cache.powWorkers[a].terminate()}function startPOWCalculation(){var a=1*byID("powrequired").value,b=Date.now(),c=stringifyPost(b);if(cache.pow_status=2,byID("powtimestamp").value=b,byID("powbutton").value="Wait...",window.Worker)for(var d=0;d<cache.powThreadsCount;d++){var e=function(e){cache.powWorkers[d].postMessage({cmd:"start",timestamp:b,post_content:c,value:a})};cache.powWorkers[d]=new Worker(config.cpuboiler_path),e(cache.powWorkers[d]),cache.powWorkers[d].addEventListener("message",function(a){byID("powvalue").value=a.data,byID("powbutton").value=_("Done!"),cache.pow_status=3},!1)}else alert(_("You are using old browser (Web Workers are not supported)!"))}function getParentId(a){var b=getInt(byID(a).parentNode.parentNode.className);return b||(b=a),b}function isFocusedInput(){var a=document.activeElement.tagName;return"BODY"!=a&&"A"!=a}function getHighlightedPostNumber(){return getInt(document.location.hash)}function highlightPostByNumber(a){byID(a)&&byID(a).click()}function getFirstPostId(){if(!byID("content-container"))return null;var a=byID("content-container").byClass("post-number");return a.length?getInt(a[0].id):null}function getLastPostId(){if(!byID("content-container"))return null;var a=byID("content-container").byClass("post-number");return a.length?getInt(a[a.length-1].id):null}function getPreviousPostNumber(a){for(var b=byClass("post-number"),c=0;c<b.length;c++)if(getInt(b[c].id)==a&&c>0)return getInt(b[c-1].id);return null}function getNextPostNumber(a){for(var b=byClass("post-number"),c=0;c<b.length;c++)if(getInt(b[c].id)==a)return c+1<b.length?getInt(b[c+1].id):a;return null}function checkStyle(a){return cache.appliedStyle?void(cache.appliedStyle!=getStyle()+" "+getCookie("center_posts")&&(changeStyle(getStyle()),saveAppliedStyle(),"function"==typeof a&&a())):void saveAppliedStyle()}function changeStyle(a){setCookie("style",a,{expires:864e4,path:"/"}),setTimeout(function(){byID("styleman").href=document.location.protocol+"//"+document.location.host+config.style_path+"?"+Math.random()},10)}function getStyle(){return getCookie("style")?getCookie("style"):config.default_style}function saveAppliedStyle(){cache.appliedStyle=getStyle()+" "+getCookie("center_posts")}function init(){var a=[highlightPostInURL,saveScrollPosition,saveAppliedStyle,doSpoilers,updatePostCache,watchBoard,translateUI,addNavEvents,formatTime,addRefs,addShowPostEvents,hideHidden,insertPasswords,YouTube.init,startAutoUpdateTick,checkForNewPosts,updateTitle,insertPreferences];if(!getSetting("noinit")){var b=[],c=[],d=[];a.map(function(a){if(b.push(Date.now()),getSetting("unsafe_init"))a();else try{a()}catch(c){d.push("Error "+c.name+":"+c.message+"\n"+c.stack+"\n")}});var e=b[b.length-1]-b[0];(d.length||e>config.max_script_execution_time)&&(c.push("Useragent: "+navigator.userAgent+"\n"),c.push(d),c.push(b),askForBugReport(c))}}Object.prototype.getKeys=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return a},Object.prototype.hasKey=function(a){for(var b in this)if(this.hasOwnProperty(b)&&b==a)return!0;return!1},Object.prototype.hasValue=function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]==a)return!0;return!1},Object.prototype.append=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},Element.prototype.setProperties=function(a){for(var b in a)this[b]=a[b]},Element.prototype.byID=function(a){return this.getElementById(a)},Element.prototype.pushStyleArray=function(a){for(var b in a)this.style[b]=a[b]},Element.prototype.byClass=function(a){return this.getElementsByClassName(a)},Element.prototype.byTag=function(a){return this.getElementsByTagName(a)},Element.prototype.hasClass=function(a){for(var b=this.className.split(" "),c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},Element.prototype.insertAfter=function(a,b){var c=b.nextSibling;return c?this.insertBefore(a,c):this.appendChild(a)},Element.prototype.addClass=function(a){for(var b=this.className.split(" "),c=0;c<b.length;c++)if(b[c]==a)return;this.className+=" "+a},Element.prototype.removeClass=function(a){for(var b=this.className.split(" "),c=[],d=0;d<b.length;d++)b[d]!=a&&c.push(b[d]);this.className=c.join(" ")},Array.prototype.inArray=function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]==a)return!0;return!1},Array.prototype.getProperties=function(a,b){var c=[],b=b?b:1;for(var d in this)if(this.hasOwnProperty(d)){for(var e=this[d],f=0;b>f;f++)e=e[a];c.push(e)}return c},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},HTMLCollection.prototype.map||(HTMLCollection.prototype.map=function(a){for(var b=0;b<this.length;b++)a(this[b])});var YouTube={init:function(){if(getSetting("youtube")){var a=getSetting("max_youtube"),b=document.links;CycleThrough(b,function(c){var d=b[c],e=getPostNumByElem(d);if(e){var f=YouTube.getVideoId(d.href);if(f&&"youtube-link"!=d.className){d.className="youtube-link",d.target="_blank";var g=YouTube.addContainer(d,f),h=cache.youtube[e]?cache.youtube[e]:0;cache.youtube[e]=h+1;var i=a>h;i?YouTube.addPreview(g,f):YouTube.addOpenButton(g,f),getSetting("youtube_info")&&YouTube.getInfo(f,g)}}})}},getVideoId:function(a){var b=a.split("/")[2];if(!["youtube.com","youtu.be","www.youtube.com","www.youtu.be"].hasValue(b))return"";for(var c=a.split(/(&|\?)/),d=0;d<c.length;d++)if(/^v=[a-zA-Z0-9_-]{11}$/.test(c[d]))return c[d].substr(2);return""},addContainer:function(a,b){var c=newElement("div");c.className="youtube-container",c.id=b;var d=newElement("span");d.className="youtube-controls";var e=newElement("div");e.className="youtube-frame-container";var f=newElement("div");f.className="youtube-preview-container";var g=newElement("span");return g.className="youtube-info",a.parentNode.appendChild(c),insertAfter(c,a),c.appendChild(a),c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(g),c},addPreview:function(a,b){if(!a.byClass("youtube-preview-container")[0].childNodes[0]){var c=newElement("img");c.className="youtube-preview",c.src="https://img.youtube.com/vi/"+b+"/0.jpg",c.onclick=function(){return YouTube.expand(a,b),!1},a.byClass("youtube-preview-container")[0].appendChild(c),a.byClass("youtube-controls")[0].innerHTML=""}},addOpenButton:function(a,b){if(!a.byClass("youtube-controls")[0].childNodes[0]){var c=newElement("span");c.textContent=_("Open"),c.className="youtube-control youtube-open",c.onclick=function(){return YouTube.addPreview(a,b),!1},a.byClass("youtube-controls")[0].appendChild(c)}},parseDuration:function(a){for(var b=[],c="",d=0;d<a.length;d++){var e=a[d];-1!="0123456789".indexOf(e)?c+=e:""!=c&&(b.push(c),c="")}for(var d=0;d<b.length;d++)b[d]=normalizeIntLength(b[d],2);return b.join(":")},expand:function(a,b){a.byClass("youtube-controls")[0].innerHTML="";var c=newElement("span");c.textContent=_("Close"),c.className="youtube-control youtube-close",c.onclick=function(){return YouTube.close(a,b),!1},a.byClass("youtube-controls")[0].appendChild(c),a.byClass("youtube-preview-container")[0].innerHTML="";var d=document.createElement("iframe");d.width=560,d.height=315,d.className="youtube-frame",d.src="//www.youtube.com/embed/"+b,d.frameborder=0,d.allowfullscreen=!0,a.byClass("youtube-frame-container")[0].appendChild(d)},close:function(a,b){a.byClass("youtube-frame-container")[0].innerHTML="",YouTube.addPreview(a,b),a.byClass("youtube-controls")[0].innerHTML=""},getInfo:function(a,b){var c=function(a,c,d,e){var f=b.byClass("youtube-info")[0],g=newElement("span");g.className="youtube-title";var h=newElement("span");h.className="youtube-duration",f.appendChild(h),f.appendChild(g),g.textContent=d,h.textContent=e};if(cache.youtube[a])c(a,b,cache.youtube[a].title,cache.youtube[a].duration);else{var d="https://www.googleapis.com/youtube/v3/videos?part=snippet%2Cstatistics%2CcontentDetails&id="+a+"&key=AIzaSyAjVszM7AORWRv8za3XgsmN4Sow85mibIE",e=new XMLHttpRequest;e.open("GET",d,!0),e.send(null),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var d=JSON.parse(this.responseText);if(!d.items||!d.items[0])return;var f=d.items[0].snippet,g=YouTube.parseDuration(d.items[0].contentDetails.duration),h=f.title;c(a,b,h,g),cache.youtube[a]={title:h,duration:g}}}}}},config={hide_posts_mouse_move_delta:100,op_reflist_on_top:!1,reply_reflist_on_top:!1,reflink_prefix:">>",reflink_op_postfix:"[OP]",reflink_self_postfix:"[GET]",post_reflink_text:"No. ",highlight_timeout:5e3,clearreplyto_text:"[x]",min_update_interval:2e4,highlighted_post_delay:150,default_style:"Muon",style_path:"/static/style.php",board_path:"board.php",reply_like_class:"reply-like",loaded_post_class:"loaded-post",highlighted_post_class:"highlighted-post",outlined_post_class:"outlined-post",delform_id:"del-form",new_post_class:"new-post",underlined_link_id:"underlined-link",board_link_counter_class:"board-link-counter",favicon_path:"/favicon.ico",cpuboiler_path:"/static/js/src/cpuboiler.js",captcha_min_length:1,pow_allowed:!0,api_path:"api.php",is_mobile:"function"==typeof isMobile?isMobile():!1,"snow-delay":2,"snow-speed":1,max_script_execution_time:3e3};"undefined"!=typeof getWindowSize&&(config=collect({loaded_post_min_width:300,loaded_post_max_width:getWindowSize().x>1e3?1e3:getWindowSize().x-10},config));var DefaultSettings={time_formatting:!1,time_format:"dd.MM.yyyy (ddd) <b>HH:mm</b>:ss",time_format_i:1,highlight_posts:!1,title_format:"counter /boarddir/ - subject text boardname",update:!1,autoupdate:!0,updateinterval:40,language:"ru",reflinks:!0,youtube:!0,max_youtube:1,youtube_info:!0,center_posts:!1,ignored_boards:"",hidden_boards:"",expandspoilers:!1,saveimages:!0,noinit:!1,unsafe_init:!1,reflist_on_top:!1,tab_notification:!0,ajax_post_send:!1,preference:"pow",hidden:{},last_posts:{},password:"function"==typeof genPassword?genPassword():"",debug:!1},Ref,flags={mouseposition:{x:0,y:0}},cache={posts:{},requests:{},youtube:{},new_posts:{},check_passed:!1,pow_status:0,captcha_status:0,timeout_status:0,last_check:0,last_check_content:""},Settings,_ru,getText={ru:(_ru={Jan:"Янв",Feb:"Фев",Mar:"Мар",Apr:"Апр",May:"Май",Jun:"Июн",Jul:"Июл",Aug:"Авг",Sep:"Сен",Oct:"Окт",Nov:"Ноя",Dec:"Дек",January:"Январь",February:"Февраль",March:"Март",April:"Апрель"},_defineProperty(_ru,"May","Май"),_defineProperty(_ru,"June","Июнь"),_defineProperty(_ru,"July","Июль"),_defineProperty(_ru,"August","Август"),_defineProperty(_ru,"September","Сентябрь"),_defineProperty(_ru,"October","Октябрь"),_defineProperty(_ru,"November","Ноябрь"),_defineProperty(_ru,"December","Декабрь"),_defineProperty(_ru,"Mon","Пнд"),_defineProperty(_ru,"Tue","Втр"),_defineProperty(_ru,"Wed","Срд"),_defineProperty(_ru,"Thu","Чтв"),_defineProperty(_ru,"Fri","Птн"),_defineProperty(_ru,"Sat","Сбт"),_defineProperty(_ru,"Sun","Вск"),_defineProperty(_ru,"Monday","Понедельник"),_defineProperty(_ru,"Tuesday","Вторник"),_defineProperty(_ru,"Wednesday","Среда"),_defineProperty(_ru,"Thursday","Четверг"),_defineProperty(_ru,"Friday","Пятница"),_defineProperty(_ru,"Saturday","Суббота"),_defineProperty(_ru,"Sunday","Воскресенье"),_defineProperty(_ru,"Loading...","Загрузка..."),_defineProperty(_ru,"Processing response...","Обработка ответа..."),_defineProperty(_ru,"Something went wrong!","Ошибка!"),_defineProperty(_ru,"Thread expanded","Тред раскрыт"),_defineProperty(_ru,"Saved","Сохранено"),_defineProperty(_ru,"Autoupdate","Автообновление"),_defineProperty(_ru,"Autoupdate thread","Автообновление треда"),_defineProperty(_ru,"Interval","Интервал"),_defineProperty(_ru,"s.","с."),_defineProperty(_ru,"Notifications","Уведомления о новых постах"),_defineProperty(_ru,"Appearance","Оформление"),_defineProperty(_ru,"Buttons for text formatting in post form","Кнопки форматирования в форме поста."),_defineProperty(_ru,"Date format","Формат даты"),_defineProperty(_ru,"Year","Год"),_defineProperty(_ru,"Month","Месяц"),_defineProperty(_ru,"Day","День"),_defineProperty(_ru,"Weekday","День недели"),_defineProperty(_ru,"Hour","Час"),_defineProperty(_ru,"Minute","Минута"),_defineProperty(_ru,"Second","Секунда"),_defineProperty(_ru,"HTML tags are allowed","Можно использовать HTML-теги"),_defineProperty(_ru,"Show reflinks","Отображать обратные ссылки"),_defineProperty(_ru,"Reflinks position:","Расположение ссылок:"),_defineProperty(_ru,"Bottom","Снизу"),_defineProperty(_ru,"Top","Сверху"),_defineProperty(_ru,"Center posts","Посты по центру"),_defineProperty(_ru,"Tab Notifications","Значок на вкладке"),_defineProperty(_ru,"Show quick format buttons","Кнопки быстрого форматирования"),_defineProperty(_ru,"Show YouTube preview","Отображать превью для YouTube"),_defineProperty(_ru,"Load video title and duration","Загружать длительность и заголовок видео"),_defineProperty(_ru,"YouTube previews in post","Количество превью для YouTube в посте"),_defineProperty(_ru,"Expand spoilers","Раскрывать спойлеры"),_defineProperty(_ru,"Interface language","Язык интерфейса"),_defineProperty(_ru,"Thread Saving","Сохранение тредов"),_defineProperty(_ru,"Save original images","Сохранять оригиналы файлов"),_defineProperty(_ru,"Defaults","По умолчанию"),_defineProperty(_ru,"Apply","Применить"),_defineProperty(_ru,"Default values were applied","Установлены значения по умолчанию"),_defineProperty(_ru,"Replies:","Ответы:"),_defineProperty(_ru,"New thread","Новый тред"),_defineProperty(_ru,"To thread","В тред"),_defineProperty(_ru,"Subject","Тема"),_defineProperty(_ru,"Message","Текст"),_defineProperty(_ru,"File","Файл"),_defineProperty(_ru,"No File","Без файла"),_defineProperty(_ru,"Password","Пароль"),_defineProperty(_ru,"Loaded:","Загружено:"),_defineProperty(_ru,"posts","постов"),_defineProperty(_ru,"Thread №","Тред №"),_defineProperty(_ru,"or","или"),_defineProperty(_ru,"expand thread","развернуть тред"),_defineProperty(_ru,"Style:","Стиль:"),_defineProperty(_ru,"No new posts","Нет новых постов"),_defineProperty(_ru,"Post not found!","Пост не найден"),_defineProperty(_ru,"Error: unknown error.","Ошибка: неизвестная ошибка."),_defineProperty(_ru,"Error: no internet connection","Ошибка: нет соединения с интернетом"),_defineProperty(_ru,"Error: thread not found (404)","Ошибка: тред не найден (404)"),_defineProperty(_ru,"Error: server sent corrupted data.","Ошибка: сервер отправил поврежденные данные."),_defineProperty(_ru,"preview","просмотр"),_defineProperty(_ru,"New posts:","Новых постов:"),_defineProperty(_ru,"Open","Открыть"),_defineProperty(_ru,"Close","Закрыть"),_defineProperty(_ru,"Post was deleted by","Пост был удалён"),_defineProperty(_ru,"it's author","автором"),_defineProperty(_ru,"moderator","модератором"),_defineProperty(_ru,"File removed","Файл удалён"),_defineProperty(_ru,"Settings","Настройки"),_defineProperty(_ru,"Supported file formats","Поддерживаемые форматы файлов"),_defineProperty(_ru,"Maximum file size","Маскимальный размер файла"),_defineProperty(_ru,"Images greater than","Изображения, большие"),_defineProperty(_ru,"will be thumbnailed","будут уменьшены"),_defineProperty(_ru,"Currently",""),_defineProperty(_ru,"unique user posts","уникальных постов"),_defineProperty(_ru,"FAQ & rules","FAQ и правила"),_defineProperty(_ru,"Catalog","Каталог"),_defineProperty(_ru,"Expand","Раскрыть"),_defineProperty(_ru,"Other","Дополнительно"),_defineProperty(_ru,"for post and file deletion","для удаления постов и файлов"),_defineProperty(_ru,"Delete post","Удалить пост"),_defineProperty(_ru,"File Only","Только файл"),_defineProperty(_ru,"Previous","Назад"),_defineProperty(_ru,"Next","Дальше"),_defineProperty(_ru,"Preview selected image","Предпросмотр выбранного изображения"),_defineProperty(_ru,"Reply","Ответ"),_defineProperty(_ru,"Submit","Отправить"),_defineProperty(_ru,"Confirm post sending","Подтверждение отправки поста"),_defineProperty(_ru,"Please enter CAPTCHA:","Введите символы с картинки:"),_defineProperty(_ru,'Please press "submit" to send your post.','Нажмите "Submit" чтобы отправить пост.'),_defineProperty(_ru,"You are now able to post.","Теперь вы можете постить!"),_defineProperty(_ru,"Enter message first!","Вы ничего не написали в сообщении!"),_defineProperty(_ru,"You need to wait","Необходимо подождать"),_defineProperty(_ru,"Or calculate POW","Или вычислите POW"),_defineProperty(_ru,"seconds","с"),_defineProperty(_ru,"Select file you want to post.","Выберите файл, который вы хотите запостить"),_defineProperty(_ru,"You are using old browser (Web Workers are not supported)!","Вы используете устаревший браузер (Web Workers не поддерживаются)!"),_defineProperty(_ru,'Please press "submit" to send your post.',"Пожалуйста, подтвердите отправку поста."),_ru),en:{}},TimeText={months_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months_full:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdays_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},TimeFormats={MMMM:["\x00",_("January"),_("February"),_("March"),_("April"),_("May"),_("June"),_("July"),_("August"),_("September"),_("October"),_("November"),_("December")],MMM:["",_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")],dddd:["",_("Sunday"),_("Monday"),_("Tuesday"),_("Wednesday"),_("Thursday"),_("Friday"),_("Saturday")],ddd:["",_("Sun"),_("Mon"),_("Tue"),_("Wed"),_("Thu"),_("Fri"),_("Sat")]};cache.powThreadsCount=2,cache.powWorkers=[],document.addEventListener("DOMContentLoaded",startConfirmationTimer);var hknav={getPost:function(){cache.nav},j:function(){var a=getHighlightedPostNumber();a?highlightPostByNumber(getNextPostNumber(a)):(a=getFirstPostId(),highlightPostByNumber(a))},k:function(){var a=getHighlightedPostNumber();a?(a=getPreviousPostNumber(a),a&&highlightPostByNumber(a)):(a=getLastPostId(),highlightPostByNumber(a))},h:function(){if(!config.ispage){var a=newElement("a");a.href="../",document.body.appendChild(a),a.click()}},l:function(){if(config.ispage&&getHighlightedPostNumber()){var a=getParentId(getHighlightedPostNumber());if(a){var b=byID("replybutton-"+a),c=b.href;c=c+"#"+getHighlightedPostNumber(),window.open(c,"_self")}}},reply:function(){if(!isFocusedInput()&&getHighlightedPostNumber()){var a=getHighlightedPostNumber(),b=getParentId(a);postReply(null,a,b,!1)}},esc:function(){var a=document.activeElement,b=a.tagName;-1!=["TEXTAREA","INPUT"].indexOf(b)&&a.blur()},i:function(){purgeAllNewPostNotifications()}};window.addEventListener("keydown",function(a){if(isFocusedInput())"Escape"==a.key&&hknav.esc();else if(!a.ctrlKey&&!a.altKey&&!a.shiftKey){var b=a.keyCode;switch(b){case 73:hknav.i();break;case 96:hknav.i();break;case 74:hknav.j();break;case 98:hknav.j();break;case 75:hknav.k();break;case 104:hknav.k();break;case 76:hknav.l();break;case 102:hknav.l();break;case 72:hknav.h();break;case 100:hknav.h();break;case 82:hknav.reply(),a.preventDefault();break;case 105:hknav.reply(),a.preventDefault()}}}),document.addEventListener("DOMContentLoaded",function(){window.addEventListener("focus",checkStyle)}),loadSettings(),document.addEventListener("DOMContentLoaded",init),window.addEventListener("hashchange",highlightPostInURL);