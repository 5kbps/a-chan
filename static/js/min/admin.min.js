"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function isAdmin(){if("allboards"==getCookie("kumod"))return!0;if(""!=getCookie("kumod")){var a=getCookie("kumod").split("|"),b=document.getElementById("postform").board.value;for(var c in a)if(a[c]==b)return!0}return!1}function addAdminStyle(){document.head.innerHTML+='<style src="/static/css/admin.css"></style>'}function colorize(a){return"#"+md5(a).substr(0,6)}function togglePassword(){var a=-1!=navigator.userAgent.indexOf("Safari"),b=-1!=navigator.userAgent.indexOf("Opera"),c="Netscape"==navigator.appName,d=document.getElementById("passwordbox");if(d){var e;e=a||b||c?d.innerHTML:d.text,e=e.toLowerCase();var f="<td></td><td></td>";if(e==f)var f='<td class="postblock">Mod</td><td><input type="text" name="modpassword" size="28" maxlength="75">&nbsp;<acronym title="Display staff status (Mod/Admin)">D</acronym>:&nbsp;<input type="checkbox" name="displaystaffstatus" checked>&nbsp;<acronym title="Lock">L</acronym>:&nbsp;<input type="checkbox" name="lockonpost">&nbsp;&nbsp;<acronym title="Sticky">S</acronym>:&nbsp;<input type="checkbox" name="stickyonpost">&nbsp;&nbsp;<acronym title="Raw HTML">RH</acronym>:&nbsp;<input type="checkbox" name="rawhtml">&nbsp;&nbsp;<acronym title="Name">N</acronym>:&nbsp;<input type="checkbox" name="usestaffname"></td>';a||b||c?d.innerHTML=f:d.text=f}return!1}function modActions(){isAdmin()&&(banLinks(),addAdminStyle(),addPostSubjectEditors())}function ipHash(a){if(4==a.split(".").length&&!a.indexOf(":")+1){var b=a.split("."),c=getInt(b[0]),d=getInt(b[3]),e=getInt(b[2]),f=""+(.5+getInt(b[1])/510),g=c+d+e>381?"black":"white";return"background-color:rgba("+c+","+d+","+e+","+f.substr(0,4)+");color:"+g+";"}return"background-color:rgba(255,255,255,1);color:black;"}function searchIP(a){var b=new XMLHttpRequest;b.open("GET","/manage_page.php?action=ipsearch&board=all&nocss=1&ip="+a),b.send(null),b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){byID("ipsearch-preview")&&byID("ipsearch-preview").remove();var a=newElement("div");a.style.position="fixed",a.style.top=0,a.style.bottom=0,a.style.right=0,a.style.width="50%",a.style.overflow="auto",a.className="reply-like",a.id="ipsearch-preview",a.innerHTML=this.responseText,document.body.appendChild(a),a.ondblclick=function(){a.remove()}}}}function searchSession(a){var b=new XMLHttpRequest;b.open("GET","/manage_page.php?action=sessionsearch&nocss=1&session="+a),b.send(null),b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){byID("ipsearch-preview")&&byID("ipsearch-preview").remove();var a=newElement("div");a.style.position="fixed",a.style.top=0,a.style.bottom=0,a.style.right=0,a.style.width="50%",a.style.overflow="auto",a.className="reply-like",a.id="ipsearch-preview",a.innerHTML=this.responseText,document.body.appendChild(a),a.ondblclick=function(){a.remove()}}}}function banLinks(){if(isAdmin()){togglePassword();var a=document.getElementById("fileonly");a&&(a=a.parentNode,a.innerHTML='[<input type="checkbox" name="fileonly" id="fileonly" value="on" /><label for="fileonly">File Only</label>] <input name="moddelete" onclick="return confirm(_(\'Are you sure you want to delete these posts?\'))" value="'+_("Delete")+'" type="submit" /> <input name="modban" value="'+_("Ban")+'" onclick="this.form.action=\'/manage_page.php?action=bans\';" type="submit" />');var b=getAllPostNumbers(),c=new XMLHttpRequest;c.open("GET","/manage_page.php?action=getips&boarddir="+config.board+"&ids="+b.join(",")),c.send(null),c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=JSON.parse(this.responseText);for(g in a){var b=a[g].ip,c=a[g].session,d=document.getElementById("dnb-"+config.board+"-"+g);if(d){var e="";c&&(e+="[ <span onclick=\"searchSession('"+c+"');\" onmouseleave=\"this.innerHTML='"+c.substr(0,5)+"';\" onmouseenter=\"this.innerHTML='"+c+'\';" class="admin-usersession" style="background-color:'+colorize(c)+'">'+c.substr(0,5)+"</span> ",e+='<a href="/manage_page.php?action=bans&session='+c+'" target="_blank" title="Ban session"> BS </a> ] '),e+='[<span class="post-ip-hash" style="'+ipHash(b)+'" onclick="searchIP(\''+b+"')\">"+b+"</span>",e+=' <a href="/manage_page.php?action=deletepostsbyip&ip='+b+'" title="'+_("Delete all posts by this IP")+'">D</a> / <a href="/manage_page.php?action=ipsearch&ip='+b+'" title="'+_("Search for posts with this IP")+'">S</a>] '+d.innerHTML,d.innerHTML=e}}}};for(var d,e,f,g,h,i,j=byClass("dnb"),k=0;k<j.length;k++)e=j[k],e.id&&(f=e.id.split("-")[1],g=e.id.split("-")[2],d=e.id.split("-"),e.innerHTML="",h="",i="y"==d[3]?"thread":"post",h+="[",h+='<a href="/manage_page.php?action=delposts&boarddir='+d[1]+"&del",h+=i+"id="+d[2]+'" title="'+_("Delete")+'" onclick="return 			confirm(_(\'Are you sure you want to delete this post/thread?\'));">D</a>',h+="&nbsp;",h+='<a href="/manage_page.php?action=delposts&boarddir='+d[1]+"&del",h+=i+"id="+d[2]+"&postid="+d[2]+'" title="'+_("Delete &amp; Ban")+'" onclick="return confirm(_(\'Are you sure you 			 want to delete and ban the poster of this post/thread?\'));">&amp;</a>',h+="&nbsp;",h+='<a href="/manage_page.php?action=bans&banboard='+d[1]+"&banpost="+d[2]+'" title="'+_("Ban")+'">B</a>',h+="] [",h+='<a href="/manage_page.php?action=softdelposts&boarddir='+d[1]+"&del",h+=i+"id="+d[2]+"&postid="+d[2]+'" title="'+_("Soft del")+'" onclick="return confirm(_(\'Are you sure you want to delete and ban			 the poster of this post/thread?\'));">SD</a>]',h+=" [",h+='<a href="/manage_page.php?action=editpost&boarddir='+config.board+"&postid="+d[2]+'">ED</a>]',h+="&nbsp;[",h+='<a href="/manage_page.php?action=bans&banboard='+d[1]+"&banpost="+d[2]+'&instant=y" title="'+_("Instant Permanent Ban")+'" onclick="instantban(\''+d[1]+"',"+d[2]+'); return false;">P</a>',h+="&#93;&nbsp;&#91;",h+='<a href="/manage_page.php?action=delposts&boarddir='+d[1]+"&del",h+=i+"id="+d[2]+"&postid="+d[2]+'&cp=y" title="'+_("Child Pornography")+'" onclick="return confirm(_(\'Are you sure			 that this is child pornography?\'));">CP</a> / ',h+='<a href="javascript:add2Spam('+d[2]+')">2SPM</a> ]',j[k].innerHTML=h)}}function add2Spam(a){var b,c="post-text-"+a,d=byID(c).textContent,e=extractDomains(d),f="\n"+e.join("\n"),g="Are you sure you want to add the following urls to spamlist? "+f,h=confirm(g);h&&(b=new XMLHttpRequest,b.open("GET","/manage_page.php?action=addtospamlist&domains="+encodeURIComponent(f)),b.send(null),b.onreadystatechange=function(){4==this.readyState&&200==this.status&&(this.textContent="added")})}function extractDomains(a){var b=[],c=/(https?:\/\/[^\s]+)/g;a.replace(c,function(a){return b.push(a),""});for(var d=0;d<b.length;d++)b[d]=function(a){var b=document.createElement("a");return b.href=a,b.hostname}(b[d]);return b=[].concat(_toConsumableArray(new Set(b)))}function getPostSubjectButtonsHTML(){var a='<span class="add-rs" onclick="addRS(this)">+</span>			 <span class="rem-rs" onclick="remRS(this)">-</span>';return a}function addRS(a){var b=prompt("Which review would you add? "+bugtracker.getPromptText());if(bugtracker.statuses[b]){var c=bugtracker.statuses[b],d=getInt(a.parentNode.parentNode.parentNode.parentNode.getElementsByClassName("post-number")[0].id),e="/manage_page.php?action=addreviewstatus&boarddir="+config.board+"&id="+d+"&status_html="+bugtracker.constructStatusHTML(c);console.log(e);var f=new XMLHttpRequest;f.open("GET",e,!0),f.send(null),f.onreadystatechange=function(){4==this.readyState&&(200==this.status?a.parentNode.parentNode.getElementsByClassName("post-subject")[0].innerHTML=this.responseText:500==this.status&&alert(this.status+":"+this.responseText+"\n"+e))}}else alert("Unrecognised input")}function addPostSubjectEditors(){for(var a=byClass("post-subject"),b=0;b<a.length;b++){var c=a[b],d=document.createElement("span");d.innerHTML=getPostSubjectButtonsHTML(),c.parentNode.appendChild(d)}}var modRequests=[];setTimeout(modActions,10);var bugtracker={statuses:[["Not a bug","not-a-bug"],["Bug","bug"],["Unrelated","unrelated"],["Fixed","fixed"],["Dollchan Extension Tools","det"],["Closed","closed"],["Duplicate","duplicate"]],getPromptText:function(){for(var a="",b=0;b<bugtracker.statuses.length;b++){var c=bugtracker.statuses[b];a+="\n"+b+": "+c[0]}return a},constructStatusHTML:function(a){return'<span class="review-status rs-'+a[1]+'">'+a[0]+"</span>"}};